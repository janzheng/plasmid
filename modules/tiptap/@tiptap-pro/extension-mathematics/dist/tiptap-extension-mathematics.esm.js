import{Extension as t}from"@tiptap/core";import{Plugin as e,PluginKey as i}from"@tiptap/pm/state";import{DecorationSet as o,Decoration as a}from"@tiptap/pm/view";import s from"katex";const r=t=>{const{regex:r,katexOptions:p={},editor:n}=t;return new e({key:new i("mathematics"),state:{init:()=>o.empty,apply(t,e,i,d){const{selection:c}=d,m=[];return d.doc.descendants(((t,e)=>{if(t.isText&&t.text){let i;for(;i=r.exec(t.text);){const t=e+i.index,o=t+i[0].length,r=i[1];if(r){const e=c.$from.pos-c.$to.pos,i=c.$anchor.pos>=t&&c.$anchor.pos<=o,d=c.$from.pos>=t&&c.$to.pos<=o,l=0===e&&i||d;l&&n.isEditable||m.push(a.widget(t,(()=>{const t=document.createElement("span");t.classList.add("Tiptap-mathematics-render"),n.isEditable&&t.classList.add("Tiptap-mathematics-render--editable");try{s.render(r,t,p)}catch(e){t.innerHTML=r}return t}))),m.push(a.inline(t,o,{class:l&&n.isEditable?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:l&&n.isEditable?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),m.length>0?o.create(d.doc,m):o.empty}},props:{decorations(t){return this.getState(t)}}})},p=t.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0}),addProseMirrorPlugins(){return[r({...this.options,editor:this.editor})]}});export{p as Mathematics,r as MathematicsPlugin,p as default};
