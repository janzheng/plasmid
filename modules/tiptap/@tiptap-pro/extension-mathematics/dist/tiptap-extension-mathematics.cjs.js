"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@tiptap/core"),e=require("@tiptap/pm/state"),i=require("@tiptap/pm/view");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=a(require("katex"));const r=t=>{const{regex:a,katexOptions:r={},editor:s}=t;return new e.Plugin({key:new e.PluginKey("mathematics"),state:{init:()=>i.DecorationSet.empty,apply(t,e,n,p){const{selection:c}=p,d=[];return p.doc.descendants(((t,e)=>{if(t.isText&&t.text){let n;for(;n=a.exec(t.text);){const t=e+n.index,a=t+n[0].length,p=n[1];if(p){const e=c.$from.pos-c.$to.pos,n=c.$anchor.pos>=t&&c.$anchor.pos<=a,l=c.$from.pos>=t&&c.$to.pos<=a,u=0===e&&n||l;u&&s.isEditable||d.push(i.Decoration.widget(t,(()=>{const t=document.createElement("span");t.classList.add("Tiptap-mathematics-render"),s.isEditable&&t.classList.add("Tiptap-mathematics-render--editable");try{o.default.render(p,t,r)}catch(e){t.innerHTML=p}return t}))),d.push(i.Decoration.inline(t,a,{class:u&&s.isEditable?"Tiptap-mathematics-editor":"Tiptap-mathematics-editor Tiptap-mathematics-editor--hidden",style:u&&s.isEditable?void 0:"display: inline-block; height: 0; opacity: 0; overflow: hidden; position: absolute; width: 0;"}))}}}})),d.length>0?i.DecorationSet.create(p.doc,d):i.DecorationSet.empty}},props:{decorations(t){return this.getState(t)}}})},s=t.Extension.create({name:"Mathematics",addOptions:()=>({regex:/\$([^\$]*)\$/gi,katexOptions:void 0}),addProseMirrorPlugins(){return[r({...this.options,editor:this.editor})]}});exports.Mathematics=s,exports.MathematicsPlugin=r,exports.default=s;
