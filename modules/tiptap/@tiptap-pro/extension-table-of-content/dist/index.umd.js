!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@tiptap/core"),require("uuid"),require("@tiptap/pm/state")):"function"==typeof define&&define.amd?define(["exports","@tiptap/core","uuid","@tiptap/pm/state"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["@tiptap-pro/extension-table-of-content"]={},t.core,t.uuid,t.state)}(this,(function(t,e,o,n){"use strict";const i=({getId:t,headingType:e="heading"})=>new n.Plugin({key:new n.PluginKey("tableOfContent"),appendTransaction(n,i,s){const d=s.tr;let a=!1;if(n.some((t=>t.docChanged))){const n=[];s.doc.descendants(((i,s)=>{const r=i.attrs["data-toc-id"];if(i.type.name===e){if(null==r||n.includes(r)){let e="";e=t?t(i.textContent):o.v4(),d.setNodeMarkup(s,void 0,{...i.attrs,"data-toc-id":e,id:e}),a=!0}n.push(r)}}))}return a?d:null}}),s=(t,e)=>{let o=t.filter((t=>t.level===e)).pop();if(0!==e)return o||(o=s(t,e-1)),o},d=t=>{const{editor:e,onUpdate:o}=t;let n=[];const i=[];let d=null;e.state.doc.descendants(((o,n)=>{if(o.type.name!==(t.headingType||"heading"))return;const i=e.view.domAtPos(n+1).node;t.storage.scrollPosition>=i.offsetTop&&(d=o.attrs["data-toc-id"])})),e.state.doc.descendants(((o,a)=>{if(o.type.name!==(t.headingType||"heading"))return;const r=e.view.domAtPos(a+1).node;i.push(r);const l=t.storage.scrollPosition>=r.offsetTop,p=s(n,o.attrs.level),c=d===o.attrs["data-toc-id"];let h=1,u=1;const g=o.attrs.level;p&&(h=p.originalLevel<g?p.level+1:p.level);const f=[...n].pop();f&&f.level<h?u=1:p&&p.level===h&&(u=p.itemIndex+1),n=[...n,{itemIndex:u,id:o.attrs["data-toc-id"],originalLevel:g,level:h,textContent:o.textContent,pos:a,editor:e,isActive:c,isScrolledOver:l,node:o,dom:r}]})),o&&o(n),t.storage.headlines=i,t.storage.content=n,e.state.tr.setMeta("toc",n),e.view.dispatch(e.state.tr)},a=e.Extension.create({name:"tableOfContent",addStorage:()=>({content:[],headlines:[],scrollHandler:()=>null,scrollPosition:0}),addGlobalAttributes(){return[{types:[this.options.headingType||"heading"],attributes:{id:{default:null,renderHTML:t=>({id:t.id}),parseHTML:t=>t.id||null},"data-toc-id":{default:null,renderHTML:t=>({"data-toc-id":t["data-toc-id"]}),parseHTML:t=>t.dataset.tocId||null}}}]},addOptions:()=>({onUpdate:()=>{},getId:t=>o.v4(),scrollParent:"undefined"!=typeof window&&window||void 0,headingType:"heading"}),onUpdate(){d({editor:this.editor,storage:this.storage,onUpdate:this.options.onUpdate,headingType:this.options.headingType})},onCreate(){const{tr:t}=this.editor.state,e=[];this.editor.state.doc.descendants(((n,i)=>{const s=n.attrs["data-toc-id"];if(n.type.name===this.options.headingType){if(null==s||e.includes(s)){let e="";e=this.options.getId?this.options.getId(n.textContent):o.v4(),t.setNodeMarkup(i,void 0,{...n.attrs,"data-toc-id":e,id:e})}e.push(s)}})),this.editor.view.dispatch(t),d({editor:this.editor,storage:this.storage,onUpdate:this.options.onUpdate,headingType:this.options.headingType}),this.storage.scrollHandler=()=>{var t;const e=this.options.scrollParent instanceof HTMLElement?this.options.scrollParent.scrollTop:null===(t=this.options.scrollParent)||void 0===t?void 0:t.scrollY;this.storage.scrollPosition=e||0,d({editor:this.editor,storage:this.storage,onUpdate:this.options.onUpdate,headingType:this.options.headingType})},this.options.scrollParent&&this.options.scrollParent.addEventListener("scroll",this.storage.scrollHandler)},onDestroy(){this.options.scrollParent&&this.options.scrollParent.removeEventListener("scroll",this.storage.scrollHandler)},addProseMirrorPlugins(){return[i({getId:this.options.getId,headingType:this.options.headingType})]}});t.TableOfContent=a,t.TableOfContentPlugin=i,t.default=a,Object.defineProperty(t,"__esModule",{value:!0})}));
